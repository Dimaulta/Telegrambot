# ContentFabrikaBot ‚Äî –ø–ª–∞–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å ContentFabrikaBot ‚Äî –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∏–∑—É—á–∞–µ—Ç —Å—Ç–∏–ª—å –∫–∞–Ω–∞–ª–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç—ã –¥–ª—è —Ä—É—á–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

## 1. –ß—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è

### –ê–∫–∫–∞—É–Ω—Ç—ã –∏ –∫–ª—é—á–∏
- **Telegram Bot** ‚Äî —Å–æ–∑–¥–∞—ë–º —á–µ—Ä–µ–∑ `@BotFather`, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω (`CONTENTFABRIKABOT_TOKEN`).
- **OpenAI** ‚Äî –Ω—É–∂–µ–Ω –¥–µ–π—Å—Ç–≤—É—é—â–∏–π `OPENAI_API_KEY` —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ `gpt-4o-mini`.

> –í—Å—ë –ø—Ä–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ, ngrok –∏ nginx —É–∂–µ —Ä–∞–∑–æ–±—Ä–∞–Ω–æ –≤ `docs/SETUP_GUIDE.md`. –ó–¥–µ—Å—å –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —à–∞–≥–∏, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è ContentFabrikaBot.

### –ú–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

- –ë–æ—Ç –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `gpt-4o-mini` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∏–ª—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤.
- –¢–∞—Ä–∏—Ñ—ã OpenAI: **$0.15 –∑–∞ 1M –≤—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤** –∏ **$0.60 –∑–∞ 1M –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤** (—Å–º. [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–∞–π—Å](https://platform.openai.com/docs/models/gpt-4o-mini)).

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   cp docs/env.example config/.env
   ```
2. –ó–∞–ø–æ–ª–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
   ```env
   CONTENTFABRIKABOT_TOKEN=123456:ABCDEF...
   OPENAI_API_KEY=sk-live-...
   ```
   - `CONTENTFABRIKABOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –∏–∑ `@BotFather`.
   - `OPENAI_API_KEY` ‚Äî –∫–ª—é—á OpenAI —Å –∞–∫—Ç–∏–≤–Ω—ã–º –±–∏–ª–ª–∏–Ω–≥–æ–º.
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å `LOG_LEVEL=debug`, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤.

## 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π OpenAI

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Å—å, —á—Ç–æ –∫–ª—é—á —Ä–∞–±–æ—á–∏–π:
```bash
curl https://api.openai.com/v1/models \
  -H "Authorization: Bearer $OPENAI_API_KEY"
```
–í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π. –û—à–∏–±–∫–∞ 401 –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥.

## 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook Telegram

–ö–æ–≥–¥–∞ –ø—É–±–ª–∏—á–Ω—ã–π URL –≥–æ—Ç–æ–≤:
```bash
source config/.env
curl -X POST "https://api.telegram.org/bot${CONTENTFABRIKABOT_TOKEN}/setWebhook" \
  -H "Content-Type: application/json" \
  -d "{\"url\":\"${BASE_URL}/contentfabrika/webhook\"}"

curl "https://api.telegram.org/bot${CONTENTFABRIKABOT_TOKEN}/getWebhookInfo"
```
- –í `getWebhookInfo` –ø–æ–ª–µ `url` –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `${BASE_URL}/contentfabrika/webhook`.
- `pending_update_count` ‚Üí 0 (–∏–ª–∏ –Ω–µ–±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤).

## 5. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
cd /Users/<user>/Desktop/projects/Telegrambot
set -a; source config/.env; set +a
swift run ContentFabrikaBot
```
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è `contentfabrikabot/db.sqlite` –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏.
- –í –ª–æ–≥–∞—Ö —É–≤–∏–¥–∏—à—å –∑–∞–≥—Ä—É–∑–∫—É `.env`, —Å—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤—Ö–æ–¥—è—â–∏–µ –≤–µ–±—Ö—É–∫–∏.
- –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π `Ctrl + C`.

## 6. –°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏

1. –í Telegram –æ—Ç–ø—Ä–∞–≤—å –±–æ—Ç—É `/start` ‚Äî –æ–Ω –ø—Ä–∏—à–ª—ë—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ–±—ä—è—Å–Ω–∏—Ç –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ (Forward ‚Üí –∞–Ω–∞–ª–∏–∑ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞).
2. –ü–µ—Ä–µ—à–ª–∏ –æ—Ç 3 –¥–æ 10 –ø–æ—Å—Ç–æ–≤ –∏–∑ —Å–≤–æ–µ–≥–æ –∫–∞–Ω–∞–ª–∞ (—Ñ—É–Ω–∫—Ü–∏—è Forward). –ü–æ—Å–ª–µ —Ç—Ä–µ—Ç—å–µ–≥–æ –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´üìö –ò–∑—É—á–∏—Ç—å –∫–∞–Ω–∞–ª¬ª.
3. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äî –±–æ—Ç —Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å —Å—Ç–∏–ª—è —á–µ—Ä–µ–∑ OpenAI.
4. –û—Ç–ø—Ä–∞–≤—å —Ç–µ–º—É/–ø—Ä–æ–º—Ç. –¢—ã –ø–æ–ª—É—á–∏—à—å –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ –º–µ–¥–∏–∞. –ë–æ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –Ω–∞–ø–æ–º–Ω–∏—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –µ–≥–æ –≤—Ä—É—á–Ω—É—é.

## 7. –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –°–∏–º–ø—Ç–æ–º | –ö–∞–∫ –ø–æ–ø—Ä–∞–≤–∏—Ç—å |
| --- | --- |
| `config/.env not found while configuring ContentFabrikaBot` | –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø—É—â–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `set -a; source config/.env; set +a` |
| `OpenAI API error 401/429` | –ü—Ä–æ–≤–µ—Ä—å –∫–ª—é—á –∏ –ª–∏–º–∏—Ç—ã –≤ –∫–∞–±–∏–Ω–µ—Ç–µ OpenAI |
| Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç | –°–ª–µ–¥—É–π —Ä–∞–∑–¥–µ–ª—É –ø—Ä–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ `docs/SETUP_GUIDE.md`, –ø—Ä–æ–≤–µ—Ä—å `BASE_URL` –∏ `getWebhookInfo` |
| –ö–Ω–æ–ø–∫–∏ ¬´–ò–∑—É—á–∏—Ç—å –∫–∞–Ω–∞–ª¬ª –Ω–µ—Ç | –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞; –±–æ—Ç —Ö—Ä–∞–Ω–∏—Ç –∏—Ö –≤ SQLite |
| –û—à–∏–±–∫–∞ ¬´–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤¬ª | –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π rate-limit (–Ω–µ –±–æ–ª—å—à–µ 2 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) |

–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –≤—ã—à–µ. –í—Å–µ —Ç–µ–∫—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã–π —á–∞—Ç —Å –∞–≤—Ç–æ—Ä–æ–º ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –∫–∞–Ω–∞–ª –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—Ä—É—á–Ω—É—é.  

