# üì¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–µ–∫–∞–ø–æ–≤ –ë–î —á–µ—Ä–µ–∑ Cron

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Cron?

**Cron** ‚Äî —ç—Ç–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –≤ Linux, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

## üìã –§–æ—Ä–º–∞—Ç cron-–∑–∞–¥–∞—á–∏

```
–º–∏–Ω—É—Ç–∞ —á–∞—Å –¥–µ–Ω—å –º–µ—Å—è—Ü –¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏ –∫–æ–º–∞–Ω–¥–∞
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `0 2 * * *` ‚Äî –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 –Ω–æ—á–∏
- `0 */6 * * *` ‚Äî –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- `0 0 * * 0` ‚Äî –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ –ø–æ–ª–Ω–æ—á—å
- `30 3 * * *` ‚Äî –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:30 —É—Ç—Ä–∞

## üîß –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è –±–µ–∫–∞–ø–æ–≤ –ë–î

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `crontab -e`

1. **–û—Ç–∫—Ä–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä crontab:**
   ```bash
   crontab -e
   ```

2. **–î–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±–µ–∫–∞–ø–∞ –≤ 3:00 –Ω–æ—á–∏:**
   ```bash
   0 3 * * * /root/Telegrambot/config/backup-databases.sh >> /root/Telegrambot/backups/backup.log 2>&1
   ```

3. **–°–æ—Ö—Ä–∞–Ω–∏ –∏ –∑–∞–∫—Ä–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä** (–≤ nano: `Ctrl+O`, `Enter`, `Ctrl+X`)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ —Ñ–∞–π–ª

1. **–°–æ–∑–¥–∞–π —Ñ–∞–π–ª —Å cron-–∑–∞–¥–∞—á–µ–π:**
   ```bash
   echo "0 3 * * * /root/Telegrambot/config/backup-databases.sh >> /root/Telegrambot/backups/backup.log 2>&1" | crontab -
   ```

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–µ–∫–∞–ø (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
0 3 * * * /root/Telegrambot/config/backup-databases.sh >> /root/Telegrambot/backups/backup.log 2>&1
```
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞—ë—Ç –±–µ–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 –Ω–æ—á–∏

### –ë–µ–∫–∞–ø –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
```bash
0 */6 * * * /root/Telegrambot/config/backup-databases.sh >> /root/Telegrambot/backups/backup.log 2>&1
```
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞—ë—Ç –±–µ–∫–∞–ø –≤ 0:00, 6:00, 12:00, 18:00

### –ë–µ–∫–∞–ø –¥–≤–∞–∂–¥—ã –≤ –¥–µ–Ω—å
```bash
0 3,15 * * * /root/Telegrambot/config/backup-databases.sh >> /root/Telegrambot/backups/backup.log 2>&1
```
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞—ë—Ç –±–µ–∫–∞–ø –≤ 3:00 –∏ 15:00

## üîç –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cron

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏:
```bash
crontab -l
```

### –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏:
```bash
crontab -r
```

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏:
```bash
crontab -e
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cron:
```bash
# –õ–æ–≥–∏ cron –æ–±—ã—á–Ω–æ –≤:
tail -f /var/log/syslog | grep CRON
# –∏–ª–∏
journalctl -u cron -f
```

## üìä –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç backup-databases.sh

1. ‚úÖ –°–æ–∑–¥–∞—ë—Ç –±–µ–∫–∞–ø—ã –æ–±–µ–∏—Ö –ë–î:
   - `monetization.sqlite`
   - `contentfabrikabot/db.sqlite`

2. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ –∏–º—è —Ñ–∞–π–ª–∞:
   - `monetization_2026-01-30_21-48-36.sqlite.backup`

3. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –±–µ–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º** (–Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `/root/...`)

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** `>> /root/Telegrambot/backups/backup.log 2>&1`
   - `>>` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
   - `2>&1` ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ —Ç—É–¥–∞ –∂–µ

3. **–ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º (`chmod +x`)

4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** Cron –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–π –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é:
```bash
/root/Telegrambot/config/backup-databases.sh
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ cron —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
# –î–æ–±–∞–≤—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–∏–Ω—É—Ç—É
# (–∑–∞–º–µ–Ω–∏ MM –Ω–∞ —Ç–µ–∫—É—â—É—é –º–∏–Ω—É—Ç—É + 1)
MM * * * * /root/Telegrambot/config/backup-databases.sh >> /root/Telegrambot/backups/test.log 2>&1
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏ backups

```
/root/Telegrambot/backups/
‚îú‚îÄ‚îÄ monetization_2026-01-30_21-48-36.sqlite.backup
‚îú‚îÄ‚îÄ contentfabrikabot_db_2026-01-30_21-48-36.sqlite.backup
‚îú‚îÄ‚îÄ backup.log  (–ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
‚îî‚îÄ‚îÄ ...
```

## üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±–µ–∫–∞–ø–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î –∏–∑ –±–µ–∫–∞–ø–∞:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—á—Ç–æ–±—ã –ë–î –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å)
docker compose -f docker-compose.prod.yml stop nowcontrollerbot contentfabrikabot

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏ –ë–î
cp /root/Telegrambot/backups/monetization_2026-01-30_21-48-36.sqlite.backup \
   /root/Telegrambot/config/monetization.sqlite

cp /root/Telegrambot/backups/contentfabrikabot_db_2026-01-30_21-48-36.sqlite.backup \
   /root/Telegrambot/contentfabrikabot/db.sqlite

# –ó–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—Ä–∞—Ç–Ω–æ
docker compose -f docker-compose.prod.yml start nowcontrollerbot contentfabrikabot
```
