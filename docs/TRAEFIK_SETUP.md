# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Traefik —Å Let's Encrypt –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ HTTPS

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω nginx –Ω–∞ Traefik –≤ `docker-compose.prod.yml`
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Traefik (`config/traefik.yml`)
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ Let's Encrypt
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã labels –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –±–æ—Ç–æ–≤
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç HTTP ‚Üí HTTPS

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### 1. –û–±–Ω–æ–≤–∏—Ç—å email –≤ Traefik –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Ç–∫—Ä–æ–π `config/traefik.yml` –∏ –∑–∞–º–µ–Ω–∏ email –Ω–∞ —Å–≤–æ–π:

```yaml
certificatesResolvers:
  letsencrypt:
    acme:
      email: admin@nowbots.ru  # ‚Üê –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π email
```

**–í–∞–∂–Ω–æ:** Let's Encrypt –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–∞ —ç—Ç–æ—Ç email.

### 2. –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è Traefik Dashboard (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ—Å—Ç—É–ø –∫ dashboard: `admin:admin`

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—ã–π —Ö–µ—à:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
htpasswd -nb admin –Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å
```

–ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏ –≤ `docker-compose.prod.yml` —Å—Ç—Ä–æ–∫—É:
```yaml
- "traefik.http.middlewares.auth.basicauth.users=admin:$$apr1$$..."
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–£–±–µ–¥–∏—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω `nowbots.ru` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞:

```bash
dig nowbots.ru +short
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (85.208.110.226)
```

## üöÄ –ó–∞–ø—É—Å–∫

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
cd /root/Telegrambot
docker compose -f docker-compose.prod.yml up -d
```

Traefik –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç Let's Encrypt (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç HTTPS –¥–ª—è –≤—Å–µ—Ö –±–æ—Ç–æ–≤
- –ë—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω
curl -I https://nowbots.ru/neurfoto/webhook

# –ò–ª–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä–æ–π:
https://nowbots.ru/neurfoto/webhook
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Traefik Dashboard

```bash
# –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–∞):
https://traefik.nowbots.ru
# –õ–æ–≥–∏–Ω: admin, –ü–∞—Ä–æ–ª—å: admin (–∏–ª–∏ —Ç–æ—Ç —á—Ç–æ —Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª)
```

**–í–∞–∂–Ω–æ:** –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ dashboard –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å DNS –∑–∞–ø–∏—Å—å `traefik.nowbots.ru` ‚Üí IP —Å–µ—Ä–≤–µ—Ä–∞, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω.

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Traefik

```bash
docker compose -f docker-compose.prod.yml logs -f traefik
```

## üìç –ú–∞—Ä—à—Ä—É—Ç—ã –±–æ—Ç–æ–≤

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ –±–æ—Ç—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTPS:

- **Neurfotobot**: `https://nowbots.ru/neurfoto/webhook`
- **Roundsvideobot**: `https://nowbots.ru/rounds/webhook`
- **FileNowBot**: `https://nowbots.ru/filenow/webhook`
- **GSForTextBot**: `https://nowbots.ru/gs/text/webhook`
- **ContentFabrikaBot**: `https://nowbots.ru/contentfabrika/webhook`
- **PereskazNowBot**: `https://nowbots.ru/pereskaznow/webhook`
- **NowControllerBot**: `https://nowbots.ru/nowcontroller/webhook`

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:** –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã. Traefik –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç –ø–æ–ø—ã—Ç–∫—É –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞.

2. **Rate Limits Let's Encrypt:** 
   - –ù–µ –±–æ–ª–µ–µ 50 —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é –Ω–∞ –¥–æ–º–µ–Ω
   - –ù–µ –±–æ–ª–µ–µ 5 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
   - –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—Å–∏—à—å –ª–∏–º–∏—Ç, –ø—Ä–∏–¥–µ—Ç—Å—è –∂–¥–∞—Ç—å –Ω–µ–¥–µ–ª—é

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:** Traefik –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∑–∞ 30 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è.

4. **–ü–æ—Ä—Ç—ã:** –£–±–µ–¥–∏—Å—å —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ firewall:
   ```bash
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   ```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP:
   ```bash
   dig nowbots.ru +short
   ```

2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç:
   ```bash
   sudo ufw status
   ```

3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Traefik:
   ```bash
   docker compose -f docker-compose.prod.yml logs traefik | grep -i acme
   ```

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç —á–µ—Ä–µ–∑ HTTPS

1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞ –∑–∞–ø—É—â–µ–Ω:
   ```bash
   docker compose -f docker-compose.prod.yml ps
   ```

2. –ü—Ä–æ–≤–µ—Ä—å labels –≤ docker-compose.prod.yml

3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±–æ—Ç–∞:
   ```bash
   docker compose -f docker-compose.prod.yml logs -f neurfotobot
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Traefik –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://doc.traefik.io/traefik/)
- [Let's Encrypt –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://letsencrypt.org/docs/)

