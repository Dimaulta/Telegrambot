# üìã –ü–ª–∞–Ω –Ω–∞–≤–µ–¥–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –≤ –≤–µ—Ç–∫–∞—Ö

## üéØ –¶–µ–ª—å

–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–µ—Ç–æ–∫:
- **dev** ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–æ –≤ Docker –Ω–∞ Mac)
- **main** ‚Äî production (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ VPS)
- **–£–¥–∞–ª–∏—Ç—å prod** ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

- ‚úÖ **prod** ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ VPS (5 –∫–æ–º–º–∏—Ç–æ–≤ –≤–ø–µ—Ä–µ–¥–∏)
- ‚ö†Ô∏è **main** ‚Äî –æ—Ç—Å—Ç–∞—ë—Ç –æ—Ç prod –Ω–∞ 5 –∫–æ–º–º–∏—Ç–æ–≤
- ‚ö†Ô∏è **dev** ‚Äî –æ—Ç—Å—Ç–∞—ë—Ç –æ—Ç prod –Ω–∞ 5 –∫–æ–º–º–∏—Ç–æ–≤
- ‚ö†Ô∏è –ù–∞ VPS –ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ prod, –ø—É—à–∏—Ç –æ—Ç—Ç—É–¥–∞ –Ω–∞ GitHub

## üöÄ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –≠—Ç–∞–ø 1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–µ—Ç–æ–∫ (—Å–µ–π—á–∞—Å)

#### 1.1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å dev —Å prod

```bash
# –ù–∞ Mac
cd /Users/a1111/Desktop/projects/Telegrambot
git checkout dev
git pull origin prod  # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ prod
git merge prod        # –°–º–µ—Ä–¥–∂–∏—Ç—å prod –≤ dev
# –†–µ—à–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –µ—Å–ª–∏ –µ—Å—Ç—å
git push origin dev
```

#### 1.2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å main —Å prod

```bash
git checkout main
git pull origin prod  # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ prod
git merge prod        # –°–º–µ—Ä–¥–∂–∏—Ç—å prod –≤ main
# –†–µ—à–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –µ—Å–ª–∏ –µ—Å—Ç—å
git push origin main
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç—Ä–∏ –≤–µ—Ç–∫–∏ (prod, main, dev) –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏.

### –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ workflow (—Å–µ–≥–æ–¥–Ω—è)

#### 2.1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∏–∑ main

**–°–æ–∑–¥–∞—Ç—å GitHub Actions workflow:**

–§–∞–π–ª: `.github/workflows/deploy.yml`

```yaml
name: Deploy to Production

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy to VPS
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          port: ${{ secrets.VPS_SSH_PORT }}
          key: ${{ secrets.VPS_SSH_KEY }}
          script: |
            cd /root/Telegrambot
            git fetch origin
            git checkout main
            git pull origin main
            docker compose -f docker-compose.prod.yml build
            docker compose -f docker-compose.prod.yml up -d
            set -a; source config/.env; set +a
            ./config/set-webhooks.sh
            docker compose -f docker-compose.prod.yml ps
```

#### 2.2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Secrets –≤ GitHub

1. GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
2. –î–æ–±–∞–≤–∏—Ç—å:
   - `VPS_HOST` = `nowbots.ru`
   - `VPS_USER` = `root`
   - `VPS_SSH_PORT` = `2222`
   - `VPS_SSH_KEY` = —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/id_ed25519` (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á)

#### 2.3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VPS –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å main

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/Telegrambot
git checkout main
git pull origin main
# –£–±–µ–¥–∏—Å—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
docker compose -f docker-compose.prod.yml ps
```

### –≠—Ç–∞–ø 3: –ù–æ–≤—ã–π workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

#### 3.1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ dev –≤–µ—Ç–∫–µ

**–ù–∞ Mac:**

```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ dev
git checkout dev

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ Docker –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
docker compose -f docker-compose.dev.yml up neurfotobot

# 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –≤ IDE

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ ngrok
ngrok http 8080

# 5. –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ - –∫–æ–º–º–∏—Ç–∏—Ç—å
git add .
git commit -m "[Feat]: ..."
git push origin dev
```

#### 3.2. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ - merge –≤ main

```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ main
git checkout main

# 2. –°–º–µ—Ä–¥–∂–∏—Ç—å dev
git merge dev

# 3. –ó–∞–ø—É—à–∏—Ç—å main (—ç—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π!)
git push origin main
```

#### 3.3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –û–±–Ω–∞—Ä—É–∂–∏—Ç push –≤ main
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ VPS
3. –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥
4. –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç webhooks

### –≠—Ç–∞–ø 4: –£–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ç–∫–∏ prod (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)

#### 4.1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ù–∞ VPS:**
```bash
cd /root/Telegrambot
git checkout main
git pull origin main
docker compose -f docker-compose.prod.yml ps
# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å
```

#### 4.2. –£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É prod

**–ù–∞ Mac:**
```bash
# –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É
git branch -d prod

# –£–¥–∞–ª–∏—Ç—å —É–¥–∞–ª—ë–Ω–Ω—É—é –≤–µ—Ç–∫—É
git push origin --delete prod
```

**–ù–∞ VPS:**
```bash
cd /root/Telegrambot
git branch -d prod  # –ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
```

### –≠—Ç–∞–ø 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 5.1. –£–º–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

GitHub Actions –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å:

```yaml
# –í workflow –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É:
- name: Detect changed services
  run: |
    # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ –ø–∞–ø–∫–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
    CHANGED=$(git diff --name-only HEAD~1 HEAD | cut -d'/' -f1 | sort -u)
    echo "Changed services: $CHANGED"
```

#### 5.2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –±–æ—Ç–æ–≤

–ï—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–π –±–æ—Ç:
1. –î–æ–±–∞–≤—å –µ–≥–æ –≤ `docker-compose.prod.yml`
2. –ó–∞–ø—É—à–∏ –≤ main
3. GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–µ—Ä—ë—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ—Ç–æ–∫

```
main (production)
  ‚Üë
  | merge (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤)
  |
dev (development)
```

**Workflow:**
1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ `dev` (–ª–æ–∫–∞–ª—å–Ω–æ –≤ Docker)
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
3. Merge `dev` ‚Üí `main`
4. Push `main` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ VPS

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### –°–µ–π—á–∞—Å (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è):

- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å dev —Å prod
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å main —Å prod
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –≤–µ—Ç–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD:

- [ ] –°–æ–∑–¥–∞—Ç—å `.github/workflows/deploy.yml`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Secrets –≤ GitHub
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π (—Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π push –≤ main)

### –ù–∞ VPS:

- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É main
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É prod (–µ—Å–ª–∏ –µ—Å—Ç—å)

### –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

- [ ] –£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É prod –∏–∑ GitHub
- [ ] –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É prod
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. **–ü—Ä–æ—â–µ:** —Ç–æ–ª—å–∫–æ –¥–≤–µ –≤–µ—Ç–∫–∏ (dev –∏ main)
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –¥–µ–ø–ª–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ dev, production –≤ main
4. **Docker –≤–µ–∑–¥–µ:** –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º macOS/Linux

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ù–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π –≤ main** ‚Äî —Ç–æ–ª—å–∫–æ merge –∏–∑ dev
2. **–¢–µ—Å—Ç–∏—Ä—É–π –≤ dev** –ø–µ—Ä–µ–¥ merge –≤ main
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π** —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ push –≤ main
4. **–û—Ç–∫–∞—Ç:** –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å, –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–º–º–∏—Ç –≤ main

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 25 –¥–µ–∫–∞–±—Ä—è 2025

