# ContentFabrikaBot

Telegram бот для генерации постов в стиле автора канала с использованием OpenAI API.

## Описание

ContentFabrikaBot помогает авторам Telegram каналов создавать посты в их уникальном стиле. Бот анализирует стиль написания автора на основе его предыдущих постов и генерирует новые посты по заданной теме.

## Функционал

1. **Изучение стиля**: Бот анализирует последние посты из канала и создает профиль стиля автора
2. **Генерация постов**: На основе изученного стиля и темы от пользователя генерирует новый пост
3. **Публикация**: Возможность опубликовать сгенерированный пост в канале

## Настройка

### 1. Получение токена Telegram бота

1. Открой [@BotFather](https://t.me/BotFather) в Telegram
2. Отправь команду `/newbot`
3. Следуй инструкциям и получи токен бота
4. Скопируй токен

### 2. Получение OpenAI API ключа

1. Зарегистрируйся на [OpenAI Platform](https://platform.openai.com/)
2. Перейди в раздел [API Keys](https://platform.openai.com/api-keys)
3. Создай новый API ключ
4. Скопируй ключ (он показывается только один раз!)

### 3. Настройка переменных окружения

1. Скопируй `config/env.example` в `config/.env`
2. Заполни следующие переменные:

```bash
CONTENTFABRIKABOT_TOKEN=твой_токен_от_BotFather
OPENAI_API_KEY=твой_ключ_от_OpenAI
```

### 4. Настройка webhook (если используется)

Если используешь nginx прокси, убедись что в `config/services.json` правильно настроен webhook URL.

## Использование

### Для автора канала:

1. Добавь бота в свой канал как администратора с правом публикации
2. Напиши боту `/start`
3. Нажми кнопку "Изучить канал"
4. Отправь боту 5-10 последних постов из своего канала (можно переслать или скопировать текст)
5. Дождись подтверждения, что стиль изучен
6. Отправь тему для нового поста
7. Получи готовый пост в своём стиле

## Технические детали

### База данных

Бот использует SQLite базу данных для хранения:
- Информации о каналах
- Профилей стиля авторов

База данных создается автоматически при первом запуске в файле `contentfabrikabot/db.sqlite`.

### API

- **Telegram Bot API**: Для получения обновлений и отправки сообщений
- **OpenAI API**: Для анализа стиля и генерации постов (модель: `gpt-4o-mini`)

### Ограничения Telegram Bot API

Telegram Bot API не позволяет напрямую получать историю сообщений из канала. Поэтому:
- Бот сохраняет посты в БД когда получает их через webhook (если бот админ канала)
- Или пользователь может отправить посты боту напрямую для анализа

## Структура проекта

```
contentfabrikabot/
├── Sources/
│   └── App/
│       ├── Controllers/
│       │   └── ContentFabrikaBotController.swift
│       ├── Models/
│       │   ├── Channel.swift
│       │   ├── StyleProfile.swift
│       │   └── ContentFabrikaBotUpdate.swift
│       ├── Services/
│       │   ├── OpenAIStyleService.swift
│       │   └── TelegramChannelService.swift
│       ├── Migrations/
│       │   ├── CreateChannel.swift
│       │   └── CreateStyleProfile.swift
│       ├── configure.swift
│       ├── entrypoint.swift
│       └── routes.swift
└── db.sqlite (создается автоматически)
```

## Запуск

```bash
swift run ContentFabrikaBot
```

Бот будет слушать на порту 8089 (настраивается в `config/services.json`).

## Примечания

- OpenAI API платный, учитывай стоимость использования
- Рекомендуется использовать модель `gpt-4o-mini` для экономии (она дешевле чем `gpt-4`)
- База данных SQLite хранится локально в папке проекта

