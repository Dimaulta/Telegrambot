# ๐ณ ะะฐะทัะฐะฑะพัะบะฐ ะฒ Docker

## ๐ ะะฑะทะพั

ะญัะพั ะดะพะบัะผะตะฝั ะพะฟะธััะฒะฐะตั, ะบะฐะบ ัะฐะทัะฐะฑะฐััะฒะฐัั ะฟัะพะตะบั ะปะพะบะฐะปัะฝะพ ะฒ Docker, ััะพะฑั ะธะทะฑะตะถะฐัั ะฟัะพะฑะปะตะผ ะฟัะธ ะดะตะฟะปะพะต ะฝะฐ Linux ัะตัะฒะตั.

## ๐ฏ ะะฐัะตะผ ััะพ ะฝัะถะฝะพ?

**ะัะพะฑะปะตะผะฐ:**
- ะะฐะทัะฐะฑะพัะบะฐ ะฝะฐ macOS โ ะบะพะด ะธัะฟะพะปัะทัะตั macOS-ัะฟะตัะธัะธัะฝัะต ะฟััะธ ะธ ััะฝะบัะธะธ
- ะะตะฟะปะพะน ะฝะฐ Linux โ ะบะพะด ะฝะต ัะฐะฑะพัะฐะตั ะธะปะธ ัะฐะฑะพัะฐะตั ะฟะพ-ะดััะณะพะผั
- SQLite ะฑะฐะทั ัะพะทะดะฐัััั ะฝะฐ Mac โ ัะพัะผะฐั ะผะพะถะตั ะพัะปะธัะฐัััั

**ะะตัะตะฝะธะต:**
- ะะฐะทัะฐะฑะพัะบะฐ ะฒ Docker ะบะพะฝัะตะนะฝะตัะต (Linux ะพะบััะถะตะฝะธะต)
- ะะพะด ัะตะดะฐะบัะธััะตัั ะฝะฐ Mac ะฒ IDE (ัะดะพะฑะฝะพ)
- ะะฐะฟััะบ ะฟัะพะธััะพะดะธั ะฒ Linux ะบะพะฝัะตะนะฝะตัะต (ะบะฐะบ ะฝะฐ ัะตัะฒะตัะต)
- ะะบััะถะตะฝะธะต ะพะดะธะฝะฐะบะพะฒะพะต โ ะฟัะพะฑะปะตะผ ะฝะตั

## ๐๏ธ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั?

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Mac (ัะฒะพะน ะบะพะผะฟัััะตั)                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  IDE                              โ   โ
โ  โ  (ัะตะดะฐะบัะธััะตัั ะบะพะด ะทะดะตัั)         โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ           โ (volumes)                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Docker ะบะพะฝัะตะนะฝะตั (Linux)         โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  โ  Swift ะบะพะด ะทะฐะฟััะบะฐะตััั ะทะดะตัั โ  โ   โ
โ  โ  โ  (swift run)                 โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะปััะตะฒัะต ะผะพะผะตะฝัั:**
1. **ะะพะด ะฝะฐ Mac** โ ัะตะดะฐะบัะธััะตัั ะฒ IDE ะบะฐะบ ะพะฑััะฝะพ
2. **Volumes** โ Docker ะผะพะฝัะธััะตั ะฟะฐะฟะบะธ ั ะบะพะดะพะผ ะฒ ะบะพะฝัะตะนะฝะตั
3. **ะะฐะฟััะบ ะฒ ะบะพะฝัะตะนะฝะตัะต** โ `swift run` ะฒัะฟะพะปะฝัะตััั ะฒ Linux ะพะบััะถะตะฝะธะธ
4. **ะะบััะถะตะฝะธะต ะพะดะธะฝะฐะบะพะฒะพะต** โ ะบะฐะบ ะฝะฐ ัะตัะฒะตัะต, ัะฐะบ ะธ ะปะพะบะฐะปัะฝะพ

---

## โก ะัััััะน ััะฐัั (5 ะผะธะฝัั)

### 1. ะฃะฑะตะดะธัั, ััะพ Docker ะทะฐะฟััะตะฝ

```bash
docker --version
```

### 2. ะกะพะทะดะฐะน ะฒัะตะผะตะฝะฝัะต ะฟะฐะฟะบะธ (ะตัะปะธ ะธั ะฝะตั)

```bash
mkdir -p Roundsvideobot/Resources/temporaryvideoFiles
mkdir -p Neurfotobot/tmp
```

### 3. ะะฐะฟัััะธ ะพะดะธะฝ ัะตัะฒะธั ะดะปั ัะตััะฐ

```bash
docker compose -f docker-compose.dev.yml up nowcontrollerbot
```

### 4. ะัะพะฒะตัั ะปะพะณะธ

ะะพะปะถะฝะพ ะฑััั:
```
[ INFO ] Server started on http://0.0.0.0:8084
```

### 5. ะััะฐะฝะพะฒะธ (Ctrl+C) ะธ ะทะฐะฟัััะธ ะฒัะต ัะตัะฒะธัั

```bash
docker compose -f docker-compose.dev.yml up
```

---

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
Telegrambot/
โโโ docker-compose.dev.yml    # โ ะะพะฝัะธะณััะฐัะธั ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โโโ Dockerfile.dev            # โ Dockerfile ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โโโ docker-compose.prod.yml   # โ ะะปั production (ะฝะฐ ัะตัะฒะตัะต)
โโโ Dockerfile.prod           # โ ะะปั production (ะฝะฐ ัะตัะฒะตัะต)
โโโ [ะฟะฐะฟะบะธ ั ะฑะพัะฐะผะธ]/
    โโโ Sources/App/          # โ ะะพะด ัะตะดะฐะบัะธััะตัั ะทะดะตัั (ะฝะฐ Mac)
```

---

## ๐ ะะฑััะฝัะน workflow

### ะะฐะทัะฐะฑะพัะบะฐ:

1. **ะะฐะฟัััะธ ัะตัะฒะธัั:**
   ```bash
   docker compose -f docker-compose.dev.yml up neurfotobot
   ```

2. **ะะตะดะฐะบัะธััะน ะบะพะด ะฒ IDE** (ะบะฐะบ ะพะฑััะฝะพ)

3. **ะะพัะปะต ะธะทะผะตะฝะตะฝะธะน - ะฟะตัะตะทะฐะฟัััะธ:**
   ```bash
   docker compose -f docker-compose.dev.yml restart neurfotobot
   ```

4. **ะขะตััะธััะน ัะตัะตะท ngrok** (ะฝะฐ Mac, ะฝะต ะฒ ะบะพะฝัะตะนะฝะตัะต):
   ```bash
   ngrok http 8080
   ```

### ะะตะฟะปะพะน:

1. **ะะพะผะผะธัั ะธะทะผะตะฝะตะฝะธั:**
   ```bash
   git add .
   git commit -m "feat: ..."
   git push origin dev
   ```

2. **ะกะผะตัะดะถะธัั ะฒ main:**
   ```bash
   git checkout main
   git merge dev
   git push origin main
   ```

3. **CI/CD ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะดะตะฟะปะพะธั ะฝะฐ ัะตัะฒะตั** (ะตัะปะธ ะฝะฐัััะพะตะฝ)

---

## ๐ ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

### ะะฐะฟััะบ ัะตัะฒะธัะพะฒ

```bash
# ะะฐะฟัััะธัั ะพะดะธะฝ ัะตัะฒะธั (ะฝะฐะฟัะธะผะตั, Neurfotobot)
docker compose -f docker-compose.dev.yml up neurfotobot

# ะะฐะฟัััะธัั ะฒัะต ัะตัะฒะธัั
docker compose -f docker-compose.dev.yml up

# ะะฐะฟัััะธัั ะฒ ัะพะฝะต
docker compose -f docker-compose.dev.yml up -d
```

### ะััะฐะฝะพะฒะบะฐ

```bash
# ะััะฐะฝะพะฒะธัั ะฒัะต ัะตัะฒะธัั
docker compose -f docker-compose.dev.yml down

# ะััะฐะฝะพะฒะธัั ั ัะดะฐะปะตะฝะธะตะผ volumes (ะพััะพัะพะถะฝะพ!)
docker compose -f docker-compose.dev.yml down -v
```

### ะะพะณะธ

```bash
# ะัะต ะปะพะณะธ
docker compose -f docker-compose.dev.yml logs -f

# ะะพะฝะบัะตัะฝัะน ัะตัะฒะธั
docker compose -f docker-compose.dev.yml logs -f neurfotobot
```

### ะะตัะตะทะฐะฟััะบ

```bash
# ะะตัะตะทะฐะฟัััะธัั ะพะดะธะฝ ัะตัะฒะธั
docker compose -f docker-compose.dev.yml restart neurfotobot

# ะะตัะตะทะฐะฟัััะธัั ะฒัะต
docker compose -f docker-compose.dev.yml restart
```

### ะัะพะด ะฒ ะบะพะฝัะตะนะฝะตั

```bash
# ะะฐะนัะธ ะฒ ะบะพะฝัะตะนะฝะตั ะดะปั ะพัะปะฐะดะบะธ
docker compose -f docker-compose.dev.yml exec neurfotobot bash
```

---

## โ FAQ

**Q: ะัะถะฝะพ ะปะธ ะฟะตัะตัะพะฑะธัะฐัั ะพะฑัะฐะท ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะบะพะดะฐ?**  
A: ะะตั! ะะพะด ะผะพะฝัะธััะตััั ัะตัะตะท volume, ะธะทะผะตะฝะตะฝะธั ะฒะธะดะฝั ััะฐะทั. ะะตัะตะทะฐะฟัััะธ ะบะพะฝัะตะนะฝะตั.

**Q: ะะพะถะฝะพ ะปะธ ะธัะฟะพะปัะทะพะฒะฐัั IDE ะดะปั ะพัะปะฐะดะบะธ?**  
A: ะะฐ! IDE ัะฐะฑะพัะฐะตั ั ะบะพะดะพะผ ะฝะฐ Mac, Docker ะทะฐะฟััะบะฐะตั ะฒ Linux - ััะพ ะฝะพัะผะฐะปัะฝะพ.

**Q: ะะดะต ััะฐะฝัััั ะะ ะธ ะฒัะตะผะตะฝะฝัะต ัะฐะนะปั?**  
A: ะะฐ Mac (ะฒ ะฟะฐะฟะบะฐั ะฟัะพะตะบัะฐ), ะดะพัััะฟะฝั ะธ ะฒ ะบะพะฝัะตะนะฝะตัะต ัะตัะตะท volumes.

**Q: ะะฐะบ ะพะฑะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ?**  
A: ะะทะผะตะฝะธ `Package.swift`, ะทะฐัะตะผ ะฟะตัะตัะพะฑะตัะธ ะพะฑัะฐะท:
```bash
docker compose -f docker-compose.dev.yml build --no-cache neurfotobot
```

**Q: ะะพัะตะผั ะบะพะด ะฝะต ะพะฑะฝะพะฒะปัะตััั ะฒ ะบะพะฝัะตะนะฝะตัะต?**  
A: ะฃะฑะตะดะธัั, ััะพ volumes ะฟัะฐะฒะธะปัะฝะพ ะฝะฐัััะพะตะฝั ะฒ `docker-compose.dev.yml`. ะะพะด ะดะพะปะถะตะฝ ะผะพะฝัะธัะพะฒะฐัััั, ะฐ ะฝะต ะบะพะฟะธัะพะฒะฐัััั.

---

## ๐๏ธ ะะฐะบ ััััะพะตะฝั ัะฐะนะปั

### Docker Compose ะดะปั ัะฐะทัะฐะฑะพัะบะธ

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:** `docker compose -f docker-compose.dev.yml up`

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะะพะด ะผะพะฝัะธััะตััั ัะตัะตะท volumes (ะฝะต ะบะพะฟะธััะตััั)
- ะะฐะฟััะบะฐะตััั `swift run` (ะฝะต production build)
- ะัะฟะพะปัะทัะตััั `Dockerfile.dev` (ะฝะต `Dockerfile.prod`)
- ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะธะท `config/.env`

### Dockerfile ะดะปั ัะฐะทัะฐะฑะพัะบะธ

**ะัะฟะพะปัะทัะตั:** `swift:6.0-noble` ะดะปั ัะฐะทัะฐะฑะพัะบะธ (ะฝะต production build)

**ะัะพะฑะตะฝะฝะพััะธ:**
- Build argument ะดะปั ัะบะฐะทะฐะฝะธั ะฟัะพะดัะบัะฐ
- Install ะทะฐะฒะธัะธะผะพััะธ
- ะะฐะฑะพัะฐั ะดะธัะตะบัะพัะธั `/app`
- ะะพะฟะธััะตะผ `Package.swift` ะดะปั ัะฐะทัะตัะตะฝะธั ะทะฐะฒะธัะธะผะพััะตะน
- ะะฐะทัะตัะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ (ะบััะธััะตััั ะตัะปะธ `Package.swift` ะฝะต ะธะทะผะตะฝะธะปัั)
- ะะพะด ะฑัะดะตั ะผะพะฝัะธัะพะฒะฐัััั ัะตัะตะท volume, ะฟะพััะพะผั ะฝะต ะบะพะฟะธััะตะผ ะตะณะพ ะทะดะตัั
- ะะพ ัะผะพะปัะฐะฝะธั ะทะฐะฟััะบะฐะตะผ `swift run` (ะฟะตัะตะพะฟัะตะดะตะปัะตััั ะฒ docker-compose)

---

## ๐ Workflow ั Git

### ะะฐะทัะฐะฑะพัะบะฐ ะฒ ะฒะตัะบะต dev

```bash
# ะะตัะตะบะปััะธัั ะฝะฐ dev
git checkout dev

# ะะฐะทัะฐะฑะฐััะฒะฐะน ะฒ Docker
docker compose -f docker-compose.dev.yml up neurfotobot

# ะะพะผะผะธัั ะธะทะผะตะฝะตะฝะธั
git add .
git commit -m "feat: ..."
git push origin dev
```

### ะะตะฟะปะพะน ัะตัะตะท CI/CD

1. ะกะผะตัะดะถะธัั `dev` ะฒ `main`
2. CI/CD ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะดะตะฟะปะพะธั ะฝะฐ ัะตัะฒะตั
3. ะะปะธ ะฒัััะฝัั ะฝะฐ ัะตัะฒะตัะต:
   ```bash
   git pull origin main
   docker compose -f docker-compose.prod.yml up -d --build
   ```

---

## ๐ ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะะพะฝัะตะนะฝะตั ะฝะต ะทะฐะฟััะบะฐะตััั

1. ะัะพะฒะตัั ะปะพะณะธ:
   ```bash
   docker compose -f docker-compose.dev.yml logs neurfotobot
   ```

2. ะัะพะฒะตัั, ััะพ `.env` ัะฐะนะป ะทะฐะฟะพะปะฝะตะฝ ะฟัะฐะฒะธะปัะฝะพ

3. ะัะพะฒะตัั, ััะพ Docker ะทะฐะฟััะตะฝ:
   ```bash
   docker ps
   ```

### ะะพะด ะฝะต ะพะฑะฝะพะฒะปัะตััั

1. ะฃะฑะตะดะธัั, ััะพ volumes ะฟัะฐะฒะธะปัะฝะพ ะฝะฐัััะพะตะฝั ะฒ `docker-compose.dev.yml`
2. ะะตัะตะทะฐะฟัััะธ ะบะพะฝัะตะนะฝะตั:
   ```bash
   docker compose -f docker-compose.dev.yml restart neurfotobot
   ```

### ะัะพะฑะปะตะผั ั ะทะฐะฒะธัะธะผะพัััะผะธ

1. ะะตัะตัะพะฑะตัะธ ะพะฑัะฐะท:
   ```bash
   docker compose -f docker-compose.dev.yml build --no-cache neurfotobot
   ```

2. ะัะพะฒะตัั `Package.swift` ะฝะฐ ะพัะธะฑะบะธ

### ะัะพะฑะปะตะผั ั ะฟะพััะฐะผะธ

ะัะปะธ ะฟะพัั ะทะฐะฝัั, ะธะทะผะตะฝะธ ะตะณะพ ะฒ `docker-compose.dev.yml`:
```yaml
ports:
  - "8082:8082"  # ะะทะผะตะฝะธ ะฒะฝะตัะฝะธะน ะฟะพัั (ะปะตะฒะฐั ัะฐััั)
```

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะธะฝัะพัะผะฐัะธั

- **Production ะดะตะฟะปะพะน**: `docs/DEPLOY.md` โ ะธะฝััััะบัะธั ะฟะพ ะดะตะฟะปะพั ะฝะฐ ัะตัะฒะตั
- **ะััะธัะตะบัััะฐ**: `docs/ARCHITECTURE.md` โ ะพะฟะธัะฐะฝะธะต ะฐััะธัะตะบัััั ะฟัะพะตะบัะฐ
- **ะัััััะน ััะฐัั**: `docs/QUICK_START.md` โ ะทะฐะฟััะบ ะฑะตะท Docker (ะดะปั ัะตััะธัะพะฒะฐะฝะธั)

---

## โ ะัะพะณ

**ะะฐะทัะฐะฑะพัะบะฐ ะฒ Docker:**
- โ ะะพะด ัะตะดะฐะบัะธััะตัั ะฝะฐ Mac ะฒ IDE (ัะดะพะฑะฝะพ)
- โ ะะฐะฟััะบ ะฟัะพะธััะพะดะธั ะฒ Linux ะบะพะฝัะตะนะฝะตัะต (ะบะฐะบ ะฝะฐ ัะตัะฒะตัะต)
- โ ะะบััะถะตะฝะธะต ะพะดะธะฝะฐะบะพะฒะพะต โ ะฟัะพะฑะปะตะผ ะฟัะธ ะดะตะฟะปะพะต ะฝะตั
- โ ะะพะถะฝะพ ัะตััะธัะพะฒะฐัั ะปะพะบะฐะปัะฝะพ ัะตัะตะท ngrok

**Workflow:**
1. ะะตะดะฐะบัะธััะน ะบะพะด ะฝะฐ Mac
2. ะะฐะฟััะบะฐะน ะฒ Docker
3. ะขะตััะธััะน ัะตัะตะท ngrok
4. ะะพะผะผะธัั ะฒ `dev`
5. ะกะผะตัะดะถะธัั ะฒ `main`
6. CI/CD ะทะฐะดะตะฟะปะพะธั ะฝะฐ ัะตัะฒะตั

ะะพัะพะฒะพ! ะขะตะฟะตัั ัะฐะทัะฐะฑะพัะบะฐ ะธ ะดะตะฟะปะพะน ะฟัะพัะพะดัั ะฑะตะท ะฟัะพะฑะปะตะผ! ๐

