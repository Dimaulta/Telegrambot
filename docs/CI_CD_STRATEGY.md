# üöÄ CI/CD —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è Telegram Bot Services

## üìã –ß—Ç–æ —Ç–∞–∫–æ–µ CI/CD –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

**CI (Continuous Integration)** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ:
- –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ –∫–æ–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
- –ù–∞—Ö–æ–¥—è—Ç—Å—è –æ—à–∏–±–∫–∏ –¥–æ –¥–µ–ø–ª–æ—è

**CD (Continuous Deployment)** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
- –ü—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ –≤–µ—Ç–∫—É `prod` –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ VPS
- –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–¥

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Mac

**–ü–æ—á–µ–º—É:**
- –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞
- –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Xcode, –æ—Ç–ª–∞–¥—á–∏–∫–∏)
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—à—å production —Å–µ—Ä–≤–µ—Ä

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º macOS/Linux:**
- –ò—Å–ø–æ–ª—å–∑—É–π Docker –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: `docker compose up`
- –ü—Ä–æ–≤–µ—Ä—è–π –ø—É—Ç–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –¢–µ—Å—Ç–∏—Ä—É–π –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions

**–°—Ö–µ–º–∞:**
```
Mac ‚Üí git push ‚Üí GitHub ‚Üí GitHub Actions ‚Üí Docker build ‚Üí VPS
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç GitHub Actions:**
1. –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
2. –°–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑
3. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ VPS –ø–æ SSH
4. –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥, –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker –≤–µ–∑–¥–µ

**–ó–∞—á–µ–º:**
- –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞ Mac –∏ Linux
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø—É—Ç—è–º–∏ (–≤—Å—ë –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- –õ–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

## üéØ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
```
1. –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å –Ω–∞ Mac –ª–æ–∫–∞–ª—å–Ω–æ
2. –¢–µ—Å—Ç–∏—Ä—É–µ—à—å —á–µ—Ä–µ–∑ docker compose (–ª–æ–∫–∞–ª—å–Ω–æ)
3. –ö–æ–º–º–∏—Ç–∏—à—å –≤ GitHub
```

### –î–µ–ø–ª–æ–π:
```
1. Push –≤ –≤–µ—Ç–∫—É prod ‚Üí GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. GitHub Actions:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥
   - –°–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ VPS
   - –û–±–Ω–æ–≤–ª—è–µ—Ç docker-compose.prod.yml
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã
3. –ë–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è!
```

## ‚ùå –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å

### –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ VPS –Ω–∞–ø—Ä—è–º—É—é:
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ (–Ω—É–∂–µ–Ω SSH –¥–æ—Å—Ç—É–ø)
- ‚ùå –†–∏—Å–∫ —Å–ª–æ–º–∞—Ç—å production
- ‚ùå –ù–µ—Ç –æ—Ç–ª–∞–¥—á–∏–∫–æ–≤ –∏ —É–¥–æ–±–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚ùå –°–ª–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –∫–∞–∂–¥—ã–π —Ä–∞–∑:
- ‚ùå –õ–µ–≥–∫–æ –∑–∞–±—ã—Ç—å —á—Ç–æ-—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å
- ‚ùå –î–æ–ª–≥–æ –∏ —Å–∫—É—á–Ω–æ
- ‚ùå –†–∏—Å–∫ –æ—à–∏–±–æ–∫

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### –®–∞–≥ 1: GitHub Actions workflow

–°–æ–∑–¥–∞–π `.github/workflows/deploy-prod.yml`:

```yaml
name: Deploy to Production

on:
  push:
    branches: [prod]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.8.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
      
      - name: Deploy to VPS
        run: |
          ssh root@nowbots.ru << 'EOF'
            cd /root/Telegrambot
            git pull origin prod
            docker compose -f docker-compose.prod.yml pull
            docker compose -f docker-compose.prod.yml up -d --build
            docker compose -f docker-compose.prod.yml ps
          EOF
```

### –®–∞–≥ 2: –î–æ–±–∞–≤—å SSH –∫–ª—é—á –≤ GitHub Secrets

1. GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π secret: `SSH_PRIVATE_KEY`
3. –í—Å—Ç–∞–≤—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ SSH –∫–ª—é—á–∞ (–∫–æ—Ç–æ—Ä—ã–π –¥–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ VPS)

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑—É–π –≤–µ—Ç–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- `main` –∏–ª–∏ `dev` - —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- `prod` - production (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π)

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç (–±–µ–∑ CI/CD)

–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å GitHub Actions –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:

```bash
#!/bin/bash
# deploy.sh –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º Mac

cd ~/Telegrambot
git push origin prod
ssh root@nowbots.ru << 'EOF'
  cd /root/Telegrambot
  git pull origin prod
  docker compose -f docker-compose.prod.yml up -d --build
EOF
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Webhook –æ—Ç GitHub –∫ VPS

VPS —Å–ª—É—à–∞–µ—Ç webhook –æ—Ç GitHub –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

**–ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ:**

1. **–°–µ–π—á–∞—Å:** –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Mac, –∏—Å–ø–æ–ª—å–∑—É–π Docker –¥–ª—è —Ç–µ—Å—Ç–æ–≤
2. **–î–∞–ª—å—à–µ:** –ù–∞—Å—Ç—Ä–æ–π –ø—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç (–≤–∞—Ä–∏–∞–Ω—Ç 1)
3. **–ü–æ—Ç–æ–º:** –ö–æ–≥–¥–∞ –ø—Ä–∏–≤—ã–∫–Ω–µ—à—å - –Ω–∞—Å—Ç—Ä–æ–π GitHub Actions (–ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ!

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –í–∞—Ä–∏–∞–Ω—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è |
|---------|-----------|---------------|--------------|
| –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ VPS | ‚ùå –ù–∏–∑–∫–∞—è | ‚ùå –ù–µ—Ç | –ù–∏–∫–æ–≥–¥–∞ |
| –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π | ‚úÖ –ù–∏–∑–∫–∞—è | ‚ùå –ù–µ—Ç | –ù–∞—á–∞–ª–æ |
| –î–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç | ‚úÖ –°—Ä–µ–¥–Ω—è—è | ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ | –°–µ–π—á–∞—Å |
| GitHub Actions | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è | ‚úÖ‚úÖ –ü–æ–ª–Ω–∞—è | –ü–æ—Ç–æ–º |

## ‚úÖ –í—ã–≤–æ–¥

**–î–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:**

1. ‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Mac
2. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Docker
3. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
4. ‚ùå –ù–ï —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π –Ω–∞ VPS

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º macOS/Linux (Docker —Ä–µ—à–∞–µ—Ç)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
- –õ–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- Production —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞–±–∏–ª–µ–Ω

