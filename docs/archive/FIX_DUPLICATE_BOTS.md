# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –±–æ—Ç–æ–≤ –≤ –ë–î

## –ü—Ä–æ–±–ª–µ–º–∞

–í —Ç–∞–±–ª–∏—Ü–µ `sponsor_campaigns` –µ—Å—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã —Å —Ä–∞–∑–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º:
- `Roundsvideobot` (ID: 3) –∏ `roundsvideobot` (ID: 14)
- `Neurfotobot` (ID: 6) –∏ `neurfotobot` (ID: 15)

SQL –∑–∞–ø—Ä–æ—Å `SELECT DISTINCT bot_name` —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É, –ø–æ—ç—Ç–æ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.

## –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
–ò–∑–º–µ–Ω–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å –≤ `MonetizationDatabase.botsWithActiveSponsors()`:

```swift
// –ë–´–õ–û:
let sql = """
SELECT DISTINCT bot_name
FROM sponsor_campaigns
WHERE active = 1
  AND (expires_at IS NULL OR expires_at >= ?1)
ORDER BY bot_name ASC;
"""

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
let sql = """
SELECT DISTINCT LOWER(bot_name) as bot_name
FROM sponsor_campaigns
WHERE active = 1
  AND (expires_at IS NULL OR expires_at >= ?1)
ORDER BY bot_name ASC;
"""
```

## –†–µ—à–µ–Ω–∏–µ 2: –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–∑ –ë–î

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û—á–∏—â–∞–µ—Ç –ë–î –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –î–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ò–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
- –ù—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–°–æ–∑–¥–∞—Ç—å –±–µ–∫–∞–ø –ë–î:**
   ```bash
   cp /root/Telegrambot/config/monetization.sqlite /root/Telegrambot/backups/monetization_before_fix_$(date +%Y-%m-%d_%H-%M-%S).sqlite.backup
   ```

2. **–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º:**
   ```sql
   -- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ —Å –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏
   DELETE FROM sponsor_campaigns 
   WHERE id IN (3, 6)  -- ID –∑–∞–ø–∏—Å–µ–π —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º
   AND bot_name IN ('Roundsvideobot', 'Neurfotobot');
   ```

3. **–ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–º–µ–Ω–∞ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É:**
   ```sql
   -- –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∏–º–µ–Ω–∞ –±–æ—Ç–æ–≤ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
   UPDATE sponsor_campaigns 
   SET bot_name = LOWER(bot_name);
   ```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –†–µ—à–µ–Ω–∏–µ 1** (–∏—Å–ø—Ä–∞–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å), –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ (–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ)
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö —Å–ª—É—á–∞–µ–≤
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ë–î

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SQL –º–æ–∂–Ω–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ—á–∏—Å—Ç–∏—Ç—å –ë–î –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–†–µ—à–µ–Ω–∏–µ 2), –Ω–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
