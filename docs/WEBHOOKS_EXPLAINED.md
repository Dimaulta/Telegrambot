# üì° Webhooks - —á—Ç–æ —ç—Ç–æ –∏ –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

## ü§î –ß—Ç–æ —Ç–∞–∫–æ–µ Webhook?

**Webhook** - —ç—Ç–æ URL –∞–¥—Ä–µ—Å, –∫—É–¥–∞ Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ–±—ã—Ç–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–≤–æ–∏—Ö –±–æ—Ç–æ–≤.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram ‚Üí Webhook URL ‚Üí –¢–≤–æ–π –±–æ—Ç
```

**–ü—Ä–∏–º–µ—Ä:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É `/start`
2. Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ webhook URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://nowbots.ru/neurfoto/webhook`)
3. –¢–≤–æ–π –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ
4. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üìã –ß—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ Webhook?

**–ü–æ–ª–Ω—ã–π URL —Å –¥–æ–º–µ–Ω–æ–º –∏ –ø—É—Ç–µ–º!**

–§–æ—Ä–º–∞—Ç:
```
https://nowbots.ru/<–ø—É—Ç—å>/webhook
```

**–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±–æ—Ç–æ–≤:**
- Neurfotobot: `https://nowbots.ru/neurfoto/webhook`
- NowmttBot: `https://nowbots.ru/nowmtt/webhook`
- Roundsvideobot: `https://nowbots.ru/rounds/webhook`
- GSForTextBot: `https://nowbots.ru/gs/text/webhook`
- ContentFabrikaBot: `https://nowbots.ru/contentfabrika/webhook`
- PereskazNowBot: `https://nowbots.ru/pereskaznow/webhook`
- NowControllerBot: `https://nowbots.ru/nowcontroller/webhook`

## ‚úÖ –ù—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å Webhooks?

### –î–∞, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞!

**–ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å:**
1. ‚úÖ –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ VPS
2. ‚úÖ –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è `BASE_URL` –≤ `.env`
3. ‚úÖ –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ø—É—Ç–∏ –≤ `docker-compose.prod.yml`

**–ö–æ–≥–¥–∞ –ù–ï –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å:**
- ‚ùå –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (webhook URL –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)
- ‚ùå –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞ –±–æ—Ç–æ–≤ (URL –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º)
- ‚ùå –ü—Ä–∏ –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ (URL –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π)

## üöÄ –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å Webhooks?

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–∏—Ç –≤—Å–µ webhooks —Å—Ä–∞–∑—É:

```bash
cd /root/Telegrambot
set -a; source config/.env; set +a
./config/set-webhooks.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
- –ß–∏—Ç–∞–µ—Ç `BASE_URL` –∏–∑ `config/.env`
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –≤ Telegram API
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç webhook URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞

### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Telegram API

–î–ª—è –æ–¥–Ω–æ–≥–æ –±–æ—Ç–∞:

```bash
# –ó–∞–º–µ–Ω–∏ TOKEN –Ω–∞ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞, URL –Ω–∞ –Ω—É–∂–Ω—ã–π –ø—É—Ç—å
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url":"https://nowbots.ru/neurfoto/webhook"}'
```

**–ü—Ä–∏–º–µ—Ä –¥–ª—è Neurfotobot:**
```bash
curl -X POST "https://api.telegram.org/bot${NEURFOTOBOT_TOKEN}/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url":"https://nowbots.ru/neurfoto/webhook"}'
```

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ @BotFather (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook —á–µ—Ä–µ–∑ @BotFather, –Ω–æ —ç—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –±–æ—Ç–æ–≤.

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω?

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:

–°–∫—Ä–∏–ø—Ç `set-webhooks.sh` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç webhook –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

### –í—Ä—É—á–Ω—É—é:

```bash
# –ó–∞–º–µ–Ω–∏ TOKEN –Ω–∞ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "ok": true,
  "result": {
    "url": "https://nowbots.ru/neurfoto/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º?

1. ‚úÖ **BASE_URL –≤ .env –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:**
   ```env
   BASE_URL=https://nowbots.ru
   ```
   (–Ω–µ IP –∞–¥—Ä–µ—Å, –∞ –¥–æ–º–µ–Ω!)

2. ‚úÖ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã:**
   ```bash
   docker compose -f docker-compose.prod.yml ps
   ```
   –í—Å–µ –±–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up`

3. ‚úÖ **Traefik —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   ```bash
   docker compose -f docker-compose.prod.yml logs traefik | tail -20
   ```
   –î–æ–ª–∂–µ–Ω –±—ã—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω

4. ‚úÖ **HTTPS –¥–æ—Å—Ç—É–ø–µ–Ω:**
   ```bash
   curl -I https://nowbots.ru/neurfoto/webhook
   ```
   –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTTP/2 200 –∏–ª–∏ 404 (–Ω–æ —Å HTTPS!)

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ HTTPS!

Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è webhooks. HTTP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `https://nowbots.ru/neurfoto/webhook`
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `http://nowbots.ru/neurfoto/webhook`

### 2. –î–æ–º–µ–Ω, –∞ –Ω–µ IP!

Telegram –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç IP –∞–¥—Ä–µ—Å–∞ –¥–ª—è webhooks.

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `https://nowbots.ru/neurfoto/webhook`
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `https://85.208.110.226/neurfoto/webhook`

### 3. –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å docker-compose

–ü—É—Ç—å –≤ webhook URL –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `PathPrefix` –≤ labels Traefik:

```yaml
# docker-compose.prod.yml
- "traefik.http.routers.neurfotobot.rule=Host(`nowbots.ru`) && PathPrefix(`/neurfoto/webhook`)"
```

Webhook URL: `https://nowbots.ru/neurfoto/webhook` ‚úÖ

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

1. **–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã:**
   ```bash
   docker compose -f docker-compose.prod.yml ps
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ HTTPS —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   ```bash
   curl -I https://nowbots.ru/neurfoto/webhook
   ```

3. **–û–±–Ω–æ–≤–∏ webhooks:**
   ```bash
   cd /root/Telegrambot
   set -a; source config/.env; set +a
   ./config/set-webhooks.sh
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ webhooks —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:**
   –°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞.

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Å–µ –±–æ—Ç—ã –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Telegram —á–µ—Ä–µ–∑ webhooks! üöÄ

