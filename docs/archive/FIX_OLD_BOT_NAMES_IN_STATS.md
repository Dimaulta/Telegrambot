# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –±–æ—Ç–æ–≤ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

## –ü—Ä–æ–±–ª–µ–º–∞

–í —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –±–æ—Ç–æ–≤:
- `gsfortextbot` (12 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) - –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `golosnowbot`
- `nowmttbot` (9 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) - –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `filenowbot`

–≠—Ç–∏ –∑–∞–ø–∏—Å–∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `user_sessions` –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–æ—Ç–æ–≤.

## –ê–Ω–∞–ª–∏–∑

**–û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –¥–∞–Ω–Ω—ã–µ:**
- –§—É–Ω–∫—Ü–∏—è `MonetizationDatabase.userStats()` –¥–µ–ª–∞–µ—Ç `SELECT bot_name, COUNT(*) FROM user_sessions GROUP BY bot_name`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –±–æ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ, –≤–∫–ª—é—á–∞—è —Å—Ç–∞—Ä—ã–µ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î:**
- –í `user_sessions` –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ —Å `gsfortextbot` –∏ `nowmttbot`
- –í `NOWCONTROLLERBOT_BROADCAST_BOTS` —ç—Ç–∏—Ö –±–æ—Ç–æ–≤ —É–∂–µ –Ω–µ—Ç

## –†–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –±–æ—Ç–∞–º (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ (–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–æ—Ç—ã

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
–ò–∑–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `buildStatusText()` –≤ `NowControllerBotController.swift`:

```swift
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 754):
for (bot, count) in userStats.sorted(by: { $0.key < $1.key }) {
    lines.append("  ‚Ä¢ \(bot): \(count)")
}

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
let managedBotsEnv = Environment.get("NOWCONTROLLERBOT_BROADCAST_BOTS") ?? ""
let managedBots = managedBotsEnv
    .split(separator: ",")
    .map { $0.trimmingCharacters(in: .whitespaces).lowercased() }
    .filter { !$0.isEmpty }

for (bot, count) in userStats.sorted(by: { $0.key < $1.key }) {
    let normalizedBot = bot.lowercased()
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±–æ—Ç–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö
    if managedBots.contains(normalizedBot) {
        lines.append("  ‚Ä¢ \(bot): \(count)")
    }
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û—á–∏—â–∞–µ—Ç –ë–î –æ—Ç —Å—Ç–∞—Ä—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
- –î–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ò–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
- –ù—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–°–æ–∑–¥–∞—Ç—å –±–µ–∫–∞–ø –ë–î:**
   ```bash
   cp /root/Telegrambot/config/monetization.sqlite /root/Telegrambot/backups/monetization_before_migration_$(date +%Y-%m-%d_%H-%M-%S).sqlite.backup
   ```

2. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ:**
   ```sql
   -- –ú–∏–≥—Ä–∞—Ü–∏—è gsfortextbot -> golosnowbot
   UPDATE user_sessions 
   SET bot_name = 'golosnowbot' 
   WHERE bot_name = 'gsfortextbot';
   
   -- –ú–∏–≥—Ä–∞—Ü–∏—è nowmttbot -> filenowbot
   UPDATE user_sessions 
   SET bot_name = 'filenowbot' 
   WHERE bot_name = 'nowmttbot';
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```sql
   SELECT bot_name, COUNT(*) 
   FROM user_sessions 
   GROUP BY bot_name 
   ORDER BY bot_name;
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (–ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢–µ—Ä—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 1** (—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É), –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ (–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–æ—Ç—ã
- –õ–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –º–æ–∂–Ω–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î (–í–∞—Ä–∏–∞–Ω—Ç 2), –Ω–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
